#ifndef GAMEOBJECT_MESSAGE_FACTORY_H
#define GAMEOBJECT_MESSAGE_FACTORY_H

#include "GameObjectMessage.h"

namespace gameplay
{
    class Node;
}

/** Internal macros and templated funcitons for creating message wrappers around gameplay::AIMessage, 
    client code should only use macros defined in GameObjectCommon.h
    @script{ignore} 
*/

namespace gameobjects
{
    template<typename NodeUserDataType>
    /** @script{ignore} */
    NodeUserDataType * getNodeUserData(gameplay::Node const * node, int id);

    template<typename UnImplementedType>
    UnImplementedType getMessageProperty(Message * message, int index);

    template<>
    inline int getMessageProperty(Message * message, int index);

    template<>
    inline unsigned int getMessageProperty(Message * message, int index);

    template<>
    inline bool getMessageProperty(Message * message, int index);

    template<>
    inline float getMessageProperty(Message * message, int index);

    template<>
    inline char const * getMessageProperty(Message * message, int index);

    template<typename UnImplementedType>
    void setMessageProperty(Message * message, int index, UnImplementedType value);

    template<>
    inline void setMessageProperty(Message * message, int index, int value);

    template<>
    inline void setMessageProperty(Message * message, int index, unsigned int value);

    template<>
    inline void setMessageProperty(Message * message, int index, bool value);

    template<>
    inline void setMessageProperty(Message * message, int index, float value);

    template<>
    inline void setMessageProperty(Message * message, int index, char const * value);

    void broadcastInternal(Message * message);
}

#define GAMEOBJECTS_MESSAGE_TYPES_BEGIN_INTERNAL()\
/** @script{ignore} */\
struct Messages\
{\
    enum Type\
        {\

#define GAMEOBJECTS_MESSAGE_TYPE_INTERNAL(TypeName)\
        TypeName,

#define GAMEOBJECTS_MESSAGE_TYPES_END_INTERNAL()\
        EnumCount\
        };\
};

#define GAMEOBJECTS_GET_PROPERTY_TEMPLATED_INTERNAL(Type, Index)\
        gameobjects::getMessageProperty<Type>(message, Index)

#define GAMEOBJECTS_MESSAGE_CONSTRUCTOR_BEGIN_INTERNAL(Name)\
    Name##Message(gameobjects::Message * message)\
        {\
        GP_ASSERT(message->getId() == Messages::Type::Name);

#define GAMEOBJECTS_MESSAGE_CONSTRUCTOR_END_INTERNAL()\
        }

#define GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_SIG_BEGIN_INTERNAL()\
    static void setAndBroadcast(gameobjects::Message * message

#define GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_BEGIN_INTERNAL()\
        {\
        set(message

#define GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(Name)\
        , Name

#define GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_END_INTERNAL()\
        );\
        gameobjects::broadcastInternal(message);\
        }

#define GAMEOBJECTS_MESSAGE_SETTER_SIG_BEGIN_INTERNAL()\
    static void set(gameobjects::Message * message

#define GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(Type, Name)\
                            ,Type Name

#define GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
                            )

#define GAMEOBJECTS_MESSAGE_SETTER_BODY_BEGIN_INTERNAL(Name)\
        {\
        GP_ASSERT(message->getId() == Messages::Type::Name);

#define GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(Type, Name, Index)\
        gameobjects::setMessageProperty<Type>(message, Index, Name);

#define GAMEOBJECTS_MESSAGE_SETTER_BODY_END_INTERNAL()\
        }

#define GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(Type, Name, Index)\
        _##Name = GAMEOBJECTS_GET_PROPERTY_TEMPLATED_INTERNAL(Type, Index);

#define GAMEOBJECTS_MESSAGE_BEGIN_INTERNAL(Name, PropertyCount)\
struct Name##Message\
{\
    static gameobjects::Message * create()\
        {\
        return gameplay::AIMessage::create(Messages::Type::Name, "", "", PropertyCount);\
        }

#define GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(Type, Name)\
    Type _##Name;

#define GAMEOBJECTS_MESSAGE_END_INTERNAL() \
};

#define GAMEOBJECTS_MESSAGE_0_INTERNAL(Name)\
GAMEOBJECTS_MESSAGE_BEGIN_INTERNAL(Name, 0)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_BEGIN_INTERNAL(Name)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_BEGIN_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_BEGIN_INTERNAL(Name)\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_SIG_BEGIN_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_BEGIN_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_END_INTERNAL()\
GAMEOBJECTS_MESSAGE_END_INTERNAL()

#define GAMEOBJECTS_MESSAGE_1_INTERNAL(Name, T1, N1)\
GAMEOBJECTS_MESSAGE_BEGIN_INTERNAL(Name, 1)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T1, N1, 0)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T1, N1, 0)\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T1, N1)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N1)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_END_INTERNAL()\
GAMEOBJECTS_MESSAGE_END_INTERNAL()

#define GAMEOBJECTS_MESSAGE_2_INTERNAL(Name, T1, N1, T2, N2)\
GAMEOBJECTS_MESSAGE_BEGIN_INTERNAL(Name, 2)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T1, N1, 0)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T2, N2, 1)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T2, N2)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T1, N1, 0)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T2, N2, 1)\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T1, N1)\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T2, N2)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T2, N2)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N1)\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N2)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_END_INTERNAL()\
GAMEOBJECTS_MESSAGE_END_INTERNAL()

#define GAMEOBJECTS_MESSAGE_3_INTERNAL(Name, T1, N1, T2, N2, T3, N3)\
GAMEOBJECTS_MESSAGE_BEGIN_INTERNAL(Name, 3)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T1, N1, 0)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T2, N2, 1)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T3, N3, 2)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T2, N2)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T3, N3)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T1, N1, 0)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T2, N2, 1)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T3, N3, 2)\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T1, N1)\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T2, N2)\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T3, N3)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T2, N2)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T3, N3)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N1)\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N2)\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N3)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_END_INTERNAL()\
GAMEOBJECTS_MESSAGE_END_INTERNAL()

#define GAMEOBJECTS_MESSAGE_4_INTERNAL(Name, T1, N1, T2, N2, T3, N3, T4, N4)\
GAMEOBJECTS_MESSAGE_BEGIN_INTERNAL(Name, 4)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T1, N1, 0)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T2, N2, 1)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T3, N3, 2)\
        GAMEOBJECTS_MESSAGE_GET_PROPERTY_INTENRAL(T4, N4, 3)\
    GAMEOBJECTS_MESSAGE_CONSTRUCTOR_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T2, N2)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T3, N3)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T4, N4)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_BEGIN_INTERNAL(Name)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T1, N1, 0)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T2, N2, 1)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T3, N3, 2)\
        GAMEOBJECTS_MESSAGE_SETTER_BODY_ARG_INTERNAL(T4, N4, 3)\
    GAMEOBJECTS_MESSAGE_SETTER_BODY_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T1, N1)\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T2, N2)\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T3, N3)\
    GAMEOBJECTS_MESSAGE_PROPERTY_INTERNAL(T4, N4)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_SIG_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T1, N1)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T2, N2)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T3, N3)\
        GAMEOBJECTS_MESSAGE_SETTER_SIG_ARG_INTERNAL(T4, N4)\
    GAMEOBJECTS_MESSAGE_SETTER_SIG_END_INTERNAL()\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_BEGIN_INTERNAL()\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N1)\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N2)\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N3)\
        GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_ARG_INTERNAL(N4)\
    GAMEOBJECTS_MESSAGE_SETTER_BROADCASTER_BODY_END_INTERNAL()\
GAMEOBJECTS_MESSAGE_END_INTERNAL()

#include "GameObjectMessageFactory.inl"

#endif
